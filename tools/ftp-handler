#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path(File.dirname(__FILE__) + "/../lib")


CONFIG_FILE = "/usr/local/islandora/offline-ingest/config.yml"
STANZA      = "islandora7d"

require 'rubygems'
require 'offin/config'
require 'offin/packages'
require 'offin/db'
require 'watch-queue/watch-directory'

config = Datyl::Config.new(CONFIG_FILE, 'default')
DataBase.setup(config)

# TODO: go through all of the stanzas in the config file, adding all sites that have an ftp_root.
# we'd like to do this every so often, to pick up changes

# TODO: handle errors gracefully?  Or queueing system will properly log somehow?

config = Datyl::Config.new(CONFIG_FILE, 'default', STANZA)
wd = WatchDirectory.new(config.site, config.ftp_root)

while true
  sleep 1
  wd.enqueue_incoming_packages
end
